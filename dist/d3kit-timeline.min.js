"use strict";!function(a,b){"function"==typeof define&&define.amd?define(["d3","d3kit","labella"],b):"object"==typeof exports?module.exports=b(require("d3"),require("d3kit"),require("labella")):a.d3Kit=b(a.d3,a.d3Kit,a.labella)}(this,function(a,b,c){var d={margin:{left:40,right:20,top:20,bottom:20},initialWidth:400,initialHeight:400,scale:a.time.scale(),domain:void 0,direction:"right",dotRadius:3,layerGap:60,labella:{},keyFn:void 0,timeFn:function(a){return a.time},textFn:function(a){return a.text},dotColor:"#222",labelBgColor:"#222",labelTextColor:"#fff",linkColor:"#222",labelPadding:{left:4,right:4,top:3,bottom:2},textYOffset:"0.85em"},e=["dotClick","dotMouseover","dotMousemove","dotMouseout","labelClick","labelMouseover","labelMousemove","labelMouseout"];return b.Timeline=b.factory.createChart(d,e,function(b){function d(a){return a.w}function e(a){return a.h}function f(a){return j.scale(j.timeFn(a))}function g(){if(b.hasData()){var d=b.data();j.domain?j.scale.domain(j.domain):j.scale.domain(a.extent(d,j.timeFn)).nice(),j.scale.range([0,"left"===j.direction||"right"===j.direction?b.getInnerHeight():b.getInnerWidth()]),n.scale(j.scale);var e;switch(j.direction){case"right":n.orient("left"),e="translate(0,0)";break;case"left":n.orient("right"),e="translate("+b.getInnerWidth()+",0)";break;case"up":n.orient("bottom"),e="translate(0,"+b.getInnerHeight()+")";break;case"down":n.orient("top"),e="translate(0,0)"}l.get("main").attr("transform",e),l.get("main.axis").call(n),h(d);var g=l.get("dummy").append("text").classed("label-text",!0),k=d.map(function(a){var b=g.text(j.textFn(a))[0][0].getBBox(),d=b.width+j.labelPadding.left+j.labelPadding.right,e=b.height+j.labelPadding.top+j.labelPadding.bottom,h=new c.Node(f(a),"left"===j.direction||"right"===j.direction?e:d,a);return h.w=d,h.h=e,h});g.remove(),m.options(j.labella).nodes(k).on("end",function(){i(m.nodes())}).start(100)}}function h(a){var b=l.get("main.dot").selectAll("circle.dot").data(a,j.keyFn),c="left"===j.direction||"right"===j.direction?"cy":"cx";b.enter().append("circle").classed("dot",!0).on("click",function(a,b){k.dotClick(a,b)}).on("mouseover",function(a,b){k.dotMouseover(a,b)}).on("mousemove",function(a,b){k.dotMousemove(a,b)}).on("mouseout",function(a,b){k.dotMouseout(a,b)}).style("fill",j.dotColor).attr("r",j.dotRadius).attr(c,f),b.transition().style("fill",j.dotColor).attr("r",j.dotRadius).attr(c,f),b.exit().remove()}function i(b){function f(a){switch(j.direction){case"right":return"translate("+a.x+","+(a.y-a.dy/2)+")";case"left":return"translate("+(a.x+g-a.w)+","+(a.y-a.dy/2)+")";case"up":return"translate("+(a.x-a.dx/2)+","+a.y+")";case"down":return"translate("+(a.x-a.dx/2)+","+a.y+")"}}var g;g="left"===j.direction||"right"===j.direction?a.max(b,d):a.max(b,e);var h=new c.Renderer({nodeHeight:g,layerGap:j.layerGap,direction:j.direction});h.layout(b);var i=a.functor(j.labelBgColor),m=a.functor(j.labelTextColor),n=a.functor(j.linkColor),o=l.get("main.label").selectAll("g.label-g").data(b,j.keyFn?function(a){return j.keyFn(a.data)}:void 0),p=o.enter().append("g").classed("label-g",!0).on("click",function(a,b){k.labelClick(a.data,b)}).on("mouseover",function(a,b){k.labelMouseover(a.data,b)}).on("mousemove",function(a,b){k.labelMousemove(a.data,b)}).on("mouseout",function(a,b){k.labelMouseout(a.data,b)}).attr("transform",f);p.append("rect").classed("label-bg",!0).attr("rx",2).attr("ry",2).attr("width",d).attr("height",e).style("fill",function(a){return i(a.data)}),p.append("text").classed("label-text",!0).attr("dy",j.textYOffset).attr("x",j.labelPadding.left).attr("y",j.labelPadding.top).style("fill",function(a){return m(a.data)}).text(function(a){return j.textFn(a.data)});var q=o.transition().attr("transform",f);q.select("rect").attr("width",d).attr("height",e).style("fill",function(a){return i(a.data)}),q.select("text.label-text").attr("dy",j.textYOffset).attr("x",j.labelPadding.left).attr("y",j.labelPadding.top).style("fill",function(a){return m(a.data)}).text(function(a){return j.textFn(a.data)}),o.exit().remove();var r=l.get("main.link").selectAll("path.link").data(b,j.keyFn?function(a){return j.keyFn(a.data)}:void 0);r.enter().append("path").classed("link",!0).attr("d",function(a){return h.generatePath(a)}).style("stroke",function(a){return n(a.data)}).style("fill","none"),r.transition().style("stroke",function(a){return n(a.data)}).attr("d",function(a){return h.generatePath(a)}),r.exit().remove()}var j=b.options(),k=b.getDispatcher(),l=b.getLayerOrganizer();l.create(["dummy",{main:["axis","link","label","dot"]}]);var m=new c.Force(j.labella),n=a.svg.axis();return k.on("resize",g),k.on("options",g),k.on("data",g),l.get("main.axis").classed("axis",!0),b.mixin({axis:n,visualize:g})}),b});